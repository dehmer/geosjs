const GEOS = require('bindings')('geos')
const proj4 = require('proj4')

console.log('hello, GEOS!', GEOS)

// const wkt = 'POLYGON((15.698738 48.444298,15.70589 48.429229,15.720558 48.432961,15.710448 48.452544,15.695686 48.449683,15.698939 48.44423,15.698738 48.444298))'
// const wkt = 'LINESTRING(21750919.79646498 6485547.365184952,21740521.73550156 6526347.184665985)'
const wkt = 'LINESTRING(23.888 58.972208,23.933941 58.970967,23.980515 58.983724,24.006602 58.98393,24.031413 58.992193,24.1137 58.9987,24.136359 59.011236,24.174154 59.04703,24.196779 59.063867,24.24228 59.087827,24.263625 59.117059,24.324162 59.128151,24.356907 59.171403,24.400691 59.186689,24.431799 59.210515,24.443164 59.22187,24.50063 59.244182,24.532819 59.273914,24.576539 59.311751,24.627051 59.315672,24.666023 59.315774,24.700822 59.31209,24.755585 59.311662,24.782871 59.328937,24.840764 59.341947,24.873398 59.35329,24.874452 59.35329,24.96837 59.283886,24.988371 59.267739,25.023087 59.26881,25.068309 59.25641,25.085159 59.273098,25.159909 59.285952,25.261975 59.282558,25.340626 59.252766,25.406549 59.224578,25.482115 59.218934,25.573307 59.206728,25.640853 59.22527,25.675041 59.254175,25.75599 59.253744,25.840032 59.250002,25.840428 59.266692,25.873342 59.278333,25.958296 59.268048,25.965264 59.253465,25.99799 59.258068,26.045937 59.24316,26.078751 59.250438,26.187887 59.243576,26.232755 59.263632,26.276086 59.269152,26.308753 59.298454,26.310845 59.298428,26.320981 59.287562,26.371466 59.286513,26.408142 59.30821,26.536633 59.331559,26.620085 59.312262,26.624546 59.272348,26.654007 59.27198,26.67231 59.258827,26.686872 59.233322,26.719123 59.226445,26.773864 59.227881,26.787771 59.212072,26.92612 59.109928,26.966895 59.108248,26.972098 59.10763,27.009936 59.054799,27.018042 59.050362,27.079936 59.018663,27.081886 59.033212,27.144924 59.004688,27.181858 58.977143)'

const geometry = GEOS.readWKT(wkt)
geometry.setSRID(4326)
console.log('numPoints', geometry.getNumPoints())

const proj = proj4('EPSG:4326', 'EPSG:3857')
const buffer_3857 = geometry.transform((x, y) => proj.forward([x, y])).buffer(2000)
const buffer_4326 = buffer_3857.transform((x, y) => proj.inverse([x, y]))

buffer_3857.setSRID(3857)
buffer_4326.setSRID(4326)

// console.log('geom_3857', GEOS.writeWKT(buffer_3857))
// console.log(GEOS.writeWKT(buffer_4326))

;(() => {
  console.log('creating geometries...')
  for (let i = 0; i < 10; i++) {
    GEOS.readWKT(wkt)
  }
})()

console.log('forcing GC')
global.gc()

setTimeout(() => console.log('exiting'), 2000)

